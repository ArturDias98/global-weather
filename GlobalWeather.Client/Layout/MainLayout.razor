@using GlobalWeather.Client.Services
@inherits LayoutComponentBase

@inject AuthService AuthService
@inject IDialogService DialogService

<MudThemeProvider IsDarkMode="true"/>
<MudPopoverProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudLayout>
    <MudAppBar Elevation="1">
        <MudText Typo="Typo.h5" Class="ml-3">GloboClima</MudText>
        <MudSpacer/>
        <MudIconButton Icon="@Icons.Custom.Brands.GitHub"
                       Href="https://github.com/ArturDias98/global-weather"
                       Target="_blank">
        </MudIconButton>
        <AuthorizeView>
            <Authorized>
                <MudTooltip Text="Logout">
                    <MudIconButton Icon="@Icons.Material.Outlined.Logout"
                                   OnClick="LogOutAsync">
                    </MudIconButton>
                </MudTooltip>
            </Authorized>
            <NotAuthorized>
                <MudTooltip Text="Login">
                    <MudIconButton Icon="@Icons.Material.Outlined.Login"
                                   OnClick="LoginAsync">
                    </MudIconButton>
                </MudTooltip>
            </NotAuthorized>
        </AuthorizeView>
    </MudAppBar>
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Medium">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code{

    private async Task LoginAsync()
    {
        var options = new DialogOptions()
        {
            CloseButton = true,
            MaxWidth = MaxWidth.ExtraSmall,
            FullWidth = true
        };

        await DialogService.ShowAsync<LoginDialog>(
            "Login",
            options);
    }

    private async Task LogOutAsync()
    {
        await AuthService.ClearAsync();
    }

}